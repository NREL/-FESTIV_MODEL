%Everything here will start from NAME_VAL, converted to GAMS format, per
%unitized, written to gdx, run GAMS, then bring data back to matlab.

CREATE_RTC_GAMS_VARIABLES

per_unitize;

if Solving_Initial_Models
wgdx(['TEMP', filesep, 'RTSCUCINPUT1'],PTDF,BLOCK_COST,BLOCK_CAP,QSC,...
    RESERVE_COST,PUMPUP_PERIOD,PUMPDOWN_PERIOD,LOAD_DIST,BRANCHDATA,RESERVEVALUE,COST_CURVE,...
    INITIAL_DISPATCH_SLACK_SET,LODF,PTDF_PAR,STARTUP_PERIOD,SHUTDOWN_PERIOD,INJECTION_FACTOR,GENBUS,BRANCHBUS);
end;

wgdx(['TEMP', filesep, 'RTSCUCINPUT2'],LAST_STARTUP,LAST_SHUTDOWN,PUCOST_BLOCK_OFFSET,INTERCHANGE,LOSS_BIAS,...
    BUS_DELIVERY_FACTORS,GEN_DELIVERY_FACTORS,END_STORAGE_PENALTY_PLUS_PRICE,END_STORAGE_PENALTY_MINUS_PRICE,PUMPING_ENFORCED_OFF,PREVIOUS_UNIT_PUMPUP,...
    INTERVALS_PUMPUP_AGO,PUMPING_ENFORCED_ON,ACTUAL_PUMP_OUTPUT,LAST_PUMP_SCHEDULE,LAST_PUMPSTATUS,LAST_PUMPSTATUS_ACTUAL,INITIAL_DISPATCH_SLACK,...
    LOAD,LAST_STATUS_ACTUAL,GEN_FORCED_OUT,INTERVALS_STARTED_AGO,PREVIOUS_UNIT_STARTUP,ACTUAL_GEN_OUTPUT,LAST_GEN_SCHEDULE,RAMP_SLACK_UP,RAMP_SLACK_DOWN,...
    INTERVAL,NRTCINTERVAL,RTCINTERVAL_LENGTH,RTC_PROCESS_TIME,RTCINTERVAL_UPDATE,RTCSTART,RTCSHUT,RTCPUMPSTART,RTCPUMPSHUT,...
    LAST_STATUS,UNIT_STATUS_ENFORCED_ON,UNIT_STATUS_ENFORCED_OFF,RESERVELEVEL,VG_FORECAST,GENVALUE,STORAGEVALUE);

if rtscuc_debug==0
    system(RTSCUC_GAMS_CALL);
else
    system(RTSCUC_DEBUG_GAMS_CALL);
end

if rtscuc_running 
    [RTCPRODCOST,RTCGENSCHEDULE,RTCLMP,RTCUNITSTATUS,RTCUNITSTARTUP,RTCUNITSHUTDOWN,RTCGENRESERVESCHEDULE,...
    RTCRCP,RTCVGCURTAILMENT,RTCLOSSLOAD,RTCINSUFFRESERVE,RTCPUMPSCHEDULE,RTCSTORAGELEVEL,RTCPUMPING] ...
    = getgamsdata('TOTAL_RTSCUCOUTPUT','RTSCUC','YES',GEN,INTERVAL,BUS,BRANCH,RESERVETYPE,SYSTEMVALUE_VAL,RESERVEVALUE_VAL,GENPARAM,STORAGEVALUE_VAL,BRANCHPARAM);
elseif rpu_running
    [RPUPRODCOST,RPUGENSCHEDULE,RPULMP,RPUUNITSTATUS,RPUUNITSTARTUP,RPUUNITSHUTDOWN,RPUGENRESERVESCHEDULE,...
    RPURCP,RPUVGCURTAILMENT,RPULOSSLOAD,RPUINSUFFRESERVE,RPUPUMPSCHEDULE,RPUSTORAGELEVEL,RPUPUMPING] ...
    = getgamsdata('TOTAL_RTSCUCOUTPUT','RPU','YES',GEN,INTERVAL,BUS,BRANCH,RESERVETYPE,SYSTEMVALUE_VAL,RESERVEVALUE_VAL,GENPARAM,STORAGEVALUE_VAL,BRANCHPARAM);
end;