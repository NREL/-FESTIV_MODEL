=start
Q_RESERVE_TOTAL(INTERVAL,RESERVETYPE)..
TOTAL_RESERVE(INTERVAL,RESERVETYPE) =E= SUM(GEN,GEN_RESERVE_SCHEDULE(GEN,INTERVAL,RESERVETYPE))
         + SUM(R$(ORD(R) EQ RESERVEVALUE(RESERVETYPE,"RESERVE_INCLUSIVE")),TOTAL_RESERVE(INTERVAL,R))
;
=end
start
Q_RESERVE_BALANCE(INTERVAL,RESERVETYPE)..
TOTAL_RESERVE(INTERVAL,RESERVETYPE)         + INSUFFICIENT_RESERVE(INTERVAL,RESERVETYPE)
         + RESERVEVALUE(RESERVETYPE,"RESERVE_GOV")*SYSTEMVALUE("LOAD_DAMPING")*(LOAD(INTERVAL)-LOSS_LOAD(INTERVAL))*
         DAMPING_MULTIPLIER(INTERVAL,RESERVETYPE)*(SYSTEMVALUE("DFMAX")/SYSTEMVALUE("FREQUENCY"))
         + RESERVEVALUE(RESERVETYPE,"RESERVE_INERTIA")*SYSTEMVALUE("INERTIALOAD")*(LOAD(INTERVAL)-LOSS_LOAD(INTERVAL))
         =G= RESERVELEVEL(INTERVAL,RESERVETYPE)
;
=end
=start
Q_RESERVE_BALANCE2(INTERVAL,RESERVETYPE)..
TOTAL_RESERVE(INTERVAL,RESERVETYPE)         + INSUFFICIENT_RESERVE(INTERVAL,RESERVETYPE)
         + RESERVEVALUE(RESERVETYPE,"RESERVE_GOV")*SYSTEMVALUE("LOAD_DAMPING")*(LOAD(INTERVAL)-LOSS_LOAD(INTERVAL))*
         DAMPING_MULTIPLIER(INTERVAL,RESERVETYPE)*(SYSTEMVALUE("DFMAX")/SYSTEMVALUE("FREQUENCY"))
         + RESERVEVALUE(RESERVETYPE,"RESERVE_INERTIA")*SYSTEMVALUE("INERTIALOAD")*(LOAD(INTERVAL)-LOSS_LOAD(INTERVAL))
         =L= RESERVELEVEL(INTERVAL,RESERVETYPE)*10000
;
=end
=start
Q_RESERVE_CAPABILITY(GEN,INTERVAL,RESERVETYPE)..
GEN_RESERVE_SCHEDULE(GEN,INTERVAL,RESERVETYPE) =L=
         (UNIT_STATUS(GEN,INTERVAL) + PUMPING(GEN,INTERVAL))*RESERVEVALUE(RESERVETYPE,"RESERVE_ON")*GENVALUE(GEN,"RAMP_RATE")*RESERVEVALUE(RESERVETYPE,"RESERVE_TIME")*
                 RESERVEVALUE(RESERVETYPE,"RESERVE_AGC")*GENVALUE(GEN,"AGC_QUALIFIED")*(1-RESERVEVALUE(RESERVETYPE,"RESERVE_GOV")-RESERVEVALUE(RESERVETYPE,"RESERVE_INERTIA"))
         + (UNIT_STATUS(GEN,INTERVAL) + PUMPING(GEN,INTERVAL))*RESERVEVALUE(RESERVETYPE,"RESERVE_ON")*GENVALUE(GEN,"RAMP_RATE")*RESERVEVALUE(RESERVETYPE,"RESERVE_TIME")*
                 (1-RESERVEVALUE(RESERVETYPE,"RESERVE_AGC"))*(1-RESERVEVALUE(RESERVETYPE,"RESERVE_GOV")-RESERVEVALUE(RESERVETYPE,"RESERVE_INERTIA"))
         + (1 - UNIT_STATUS(GEN,INTERVAL) - PUMPING(GEN,INTERVAL)) * (1 - RESERVEVALUE(RESERVETYPE,"RESERVE_ON")) * QSC(GEN,RESERVETYPE)*
                 (1-RESERVEVALUE(RESERVETYPE,"RESERVE_GOV")-RESERVEVALUE(RESERVETYPE,"RESERVE_INERTIA"))
         + RESERVEVALUE(RESERVETYPE,"RESERVE_GOV")*PFR_FULL(GEN,INTERVAL)*PFR_MULTIPLIER(GEN,INTERVAL,RESERVETYPE)*
                 (1-RESERVEVALUE(RESERVETYPE,"RESERVE_INERTIA")-RESERVEVALUE(RESERVETYPE,"RESERVE_AGC"))
         + GENVALUE(GEN,"INERTIA")*(UNIT_STATUS(GEN,INTERVAL) + PUMPING(GEN,INTERVAL))*RESERVEVALUE(RESERVETYPE,"RESERVE_ON")*RESERVEVALUE(RESERVETYPE,"RESERVE_INERTIA")*
                 GENVALUE(GEN,"CAPACITY")*(1-RESERVEVALUE(RESERVETYPE,"RESERVE_GOV")-RESERVEVALUE(RESERVETYPE,"RESERVE_AGC"))
;
=end
=start
Q_RESERVE_CAPABILITY2(GEN,INTERVAL,RESERVETYPE)$(RESERVEVALUE(RESERVETYPE,"RESERVE_GOV") EQ 1)..
GEN_RESERVE_SCHEDULE(GEN,INTERVAL,RESERVETYPE) =G= PFR_FULL(GEN,INTERVAL)*PFR_MULTIPLIER(GEN,INTERVAL,RESERVETYPE)
;
=end
=start
Q_RESERVE_RAMPUP_LIMIT(GEN,INTERVAL)..
SUM(RESERVETYPE$(RESERVEVALUE(RESERVETYPE,"RESERVE_ON") EQ 1 AND (RESERVEVALUE(RESERVETYPE,"RESERVE_DIR") EQ 1 OR RESERVEVALUE(RESERVETYPE,"RESERVE_DIR") EQ 3)),
         GEN_RESERVE_SCHEDULE(GEN,INTERVAL,RESERVETYPE)/RESERVEVALUE(RESERVETYPE,"RESERVE_TIME"))
         =L= UNIT_STATUS(GEN,INTERVAL)*GENVALUE(GEN,"RAMP_RATE") + PUMPING(GEN,INTERVAL)*STORAGEVALUE(GEN,"PUMP_RAMP_RATE")
;
=end
=start
Q_RESERVE_RAMPDOWN_LIMIT(GEN,INTERVAL)..
SUM(RESERVETYPE$(RESERVEVALUE(RESERVETYPE,"RESERVE_ON") EQ 1 AND (RESERVEVALUE(RESERVETYPE,"RESERVE_DIR") EQ 2 OR RESERVEVALUE(RESERVETYPE,"RESERVE_DIR") EQ 3)),
         GEN_RESERVE_SCHEDULE(GEN,INTERVAL,RESERVETYPE)/RESERVEVALUE(RESERVETYPE,"RESERVE_TIME"))
         =L= UNIT_STATUS(GEN,INTERVAL)*GENVALUE(GEN,"RAMP_RATE") + PUMPING(GEN,INTERVAL)*STORAGEVALUE(GEN,"PUMP_RAMP_RATE")
;
=end
=start
Q_VARIABLE_RESERVE_CAPACITY(VARIABLE_GEN,INTERVAL)..
GEN_SCHEDULE(VARIABLE_GEN,INTERVAL) +
         SUM(RESERVETYPE$(RESERVEVALUE(RESERVETYPE,"RESERVE_ON")EQ 1 AND (RESERVEVALUE(RESERVETYPE,"RESERVE_DIR") EQ 1 OR RESERVEVALUE(RESERVETYPE,"RESERVE_DIR") EQ 3)),
         GEN_RESERVE_SCHEDULE(VARIABLE_GEN,INTERVAL,RESERVETYPE)) =L= VG_FORECAST(INTERVAL,VARIABLE_GEN)
;
=end
=start
Q_RESERVE_CAPABILITY_VG(VARIABLE_GEN,INTERVAL,RESERVETYPE)..
GEN_RESERVE_SCHEDULE(VARIABLE_GEN,INTERVAL,RESERVETYPE) =L= GENVALUE(VARIABLE_GEN,"CAPACITY")*RESERVEVALUE(RESERVETYPE,"RESERVE_VG")
;
=end
=start
Q_PFR_DROOP1(GEN_GOV,INTERVAL)..
PFR_FULL(GEN_GOV,INTERVAL) =L= (GOVERNOR_ENABLED(GEN_GOV,INTERVAL)/DROOP_EQ(GEN_GOV))*(SYSTEMVALUE("DFMAX")-GENVALUE(GEN_GOV,"GOV_DB"))
;
=end
=start
Q_PFR_DROOP2(GEN_GOV,INTERVAL)..
GEN_SCHEDULE(GEN_GOV,INTERVAL) + (1/DROOP_EQ(GEN_GOV))*(SYSTEMVALUE("DFMAX")-GENVALUE(GEN_GOV,"GOV_DB"))
         =G= GENVALUE(GEN_GOV,"CAPACITY") - PFR_HEADROOM(GEN_GOV,INTERVAL)*GENVALUE(GEN_GOV,"CAPACITY") - GENVALUE(GEN_GOV,"CAPACITY")*(1-GOVERNOR_ENABLED(GEN_GOV,INTERVAL))
;
=end
=start
Q_PFR_DROOP3(GEN_GOV,INTERVAL)..
PFR_FULL(GEN_GOV,INTERVAL) =G= (PFR_HEADROOM(GEN_GOV,INTERVAL)/DROOP_EQ(GEN_GOV))*(SYSTEMVALUE("DFMAX")-GENVALUE(GEN_GOV,"GOV_DB")) - GENVALUE(GEN_GOV,"CAPACITY")*
         (1-GOVERNOR_ENABLED(GEN_GOV,INTERVAL))
;
=end
=start
Q_PFR_DROOP4(GEN_GOV,INTERVAL)..
GOVERNOR_ENABLED(GEN_GOV,INTERVAL) =L= UNIT_STATUS(GEN_GOV,INTERVAL)
;
=end
=start
Q_PFR_DROOP5(GEN_GOV,INTERVAL)..
GENVALUE(GEN_GOV,"GOV_DB") =L= SYSTEMVALUE("DBMAX")  + .1*SYSTEMVALUE("FREQUENCY")*(1 - GOVERNOR_ENABLED(GEN_GOV,INTERVAL))
;
=end
